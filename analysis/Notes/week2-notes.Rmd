---
title: "Progress & Notes: 6/10-6/14"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: false
editor_options:
  chunk_output_type: console
---

## Beginning Work on TOGA
I have downloaded all dependencies and loaded TOGA on the Grace cluster but I received the following Permission Error message given the input below:
```{r toga-error, eval=FALSE}
(base) [ecbaker7@c076 toga]$ toga.py test_input/hg38.mm10.chr11.chain test_input/hg38.genCode27.chr11.bed $/toga $/toga --kt --pn test -i supply/hg38.wgEncodeGencodeCompV34.isoforms.txt --nc $/scratch/group/songlab/emily/toga/nextflow_config_files --cb 3,5 --cjn 500 --u12 supply/hg38.U12sites.tsv --ms
#### Initiating TOGA class ####
Checking dependencies...
check if binaries are compiled and libs are installed...
All dependencies found
/bin/sh: git: command not found
Traceback (most recent call last):
  File "/sw/eb/sw/TOGA/2021.12.15-foss-2019b-Python-3.7.4/toga.py", line 1965, in <module>
    main()
  File "/sw/eb/sw/TOGA/2021.12.15-foss-2019b-Python-3.7.4/toga.py", line 1960, in main
    toga_manager = Toga(args)
  File "/sw/eb/sw/TOGA/2021.12.15-foss-2019b-Python-3.7.4/toga.py", line 88, in __init__
    self.nextflow_dir = self.__get_nf_dir(args.nextflow_dir)
  File "/sw/eb/sw/TOGA/2021.12.15-foss-2019b-Python-3.7.4/toga.py", line 362, in __get_nf_dir
    os.mkdir(default_dir) if not os.path.isdir(default_dir) else None
PermissionError: [Errno 13] Permission denied: '/sw/eb/sw/TOGA/2021.12.15-foss-2019b-Python-3.7.4/nextflow_logs'
```

I have emailed the HPRC help desk and am waiting for their response on how to proceed.

Update: They answered and told me to remove the dollar signs from in front of the file paths. I tried this and also downloaded the *supply* folder from the Hiller Lab GitHub in order to have access to the U12 data, but neither of these things worked. I am waiting on another repsonse from the help desk.

Final Update: This error has been resolved with the addition of a directory for Nextflow to operate from, as well as the --nextflow_dir <directory path> flag being added to the end of the command to run TOGA. The full documentation is found [here](toga.html) under troubleshooting.

I am now having the following problem: I run TOGA and it goes until step 2 before it tries to rerun all jobs and then crashes. I then get the following message in my .out file:

```{r out-file-message, eval=FALSE}
Traceback (most recent call last):
  File "/var/spool/slurmd/job10522779/slurm_script", line 19, in <module>
    from modules.common import parts
ModuleNotFoundError: No module named 'modules'

```

The help desk has been emailed. Jackson tried to run it in a conda environment on the cluster, but that didn't work either.

Update: This has been corrected by running it through a .sh file, I will update the [TOGA page](toga.html) to reflect this change in the process. 

I am now having the following error:

```{r new-err2, eval=FALSE}
Command executed:

  sbatch .command.run

Command exit status:
  0

Command output:
  sbatch: error: (from job_submit) either --ntasks, or --ntasks-per-node, or --nodes should be provided.
  sbatch: error: Batch job submission failed: Unspecified error
  

Work dir:
  /scratch/group/songlab/emily/toga/nextflow_logs/test_chain_feats_at_1718311976/work/16/a70dc9c3f7b04b94a742de26c47b86

Tip: you can try to figure out what's wrong by changing to the process work dir and showing the script file named `.command.sh`



Error! Process nextflow /sw/eb/sw/TOGA/2021.12.15-foss-2019b-Python-3.7.4/execute_joblist.nf --joblist /scratch/group/songlab/emily/toga/test/temp/chain_class_jobs_combined -c /scratch/group/songlab/emily/toga/nextflow_config_files/extract_chain_features_config.nf died
Program finished with exit code 1

Making gene_id: bed_data dict...
```

IT believes it may have something to do with my storage on the cluster. I moved my largest folder (/home.local) to my scratch directory and created a symlink between the 2 folders as per their instructions, but this does not seem to have corrected the issue. Waiting on another response from IT.

### Friday update
I still haven't gotten TOGA to run on Grace but I have gotten it to run on the Mac tower. I am also trying to get the pipeline to convert fasta files into the necessary formats to run on the tower, but the chain-building is taking a long time and it probably won't finish running today. I have a meeting scheduled with Michael from IT on Monday to try and get the Grace Toga pipeline to run and possibly talk about updating their TOGA version to the most current. 
